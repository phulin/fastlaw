---
import searchScriptUrl from "../scripts/search.ts?url";
import Base from "../layouts/Base.astro";

const endpoint = import.meta.env.PUBLIC_SEARCH_API_URL ?? "";
---
<Base title="Authority Â· Search" description="Agentic RAG search across the CGA.">
  <main class="chat-layout" data-endpoint={endpoint}>
    <section class="chat-panel">
      <div class="chat-header">
        <p class="eyebrow">Agentic RAG Search</p>
        <h1>Ask the CGA in natural language.</h1>
        <p class="lead">
          The agent embeds your question, retrieves the most relevant sections, and responds with
          cited statute snippets.
        </p>
      </div>

      <div class="chat-thread" id="chat-thread" aria-live="polite">
        <div class="message assistant">
          <div class="message-role">Assistant</div>
          <div class="message-body">
            Ask about licensing, enforcement, or any statute. I will cite the most relevant sections.
          </div>
        </div>
      </div>

      <form class="chat-form" id="chat-form">
        <label class="chat-label" for="chat-input">Ask a question</label>
        <div class="chat-input-row">
          <textarea
            id="chat-input"
            name="query"
            rows="2"
            placeholder="Ex: What are the penalties for unlicensed daycare operations?"
            required
          ></textarea>
          <button type="submit">Send</button>
        </div>
        <div class="chat-hint">
          Add detail for better results, like a title number or chapter.
        </div>
      </form>
    </section>

    <aside class="chat-aside">
      <div class="chat-aside-card">
        <h2>Sources</h2>
        <p class="muted">Matches will appear here with links to the full statute text.</p>
        <div class="source-list" id="source-list"></div>
      </div>
      <div class="chat-aside-card">
        <h2>Workflow</h2>
        <ul class="workflow-list" id="workflow-list">
          <li>Interpret the question.</li>
          <li>Retrieve from Pinecone.</li>
          <li>Synthesize with citations.</li>
        </ul>
      </div>
      <div class="chat-aside-card">
        <h2>Trace</h2>
        <ul class="workflow-list" id="trace-list">
          <li>No trace yet.</li>
        </ul>
      </div>
    </aside>
  </main>

  <script type="module" src={searchScriptUrl}></script>
</Base>
