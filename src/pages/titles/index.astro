---
import Base from "../../layouts/Base.astro";
import { getTitles } from "../../lib/sections";

const titles = getTitles().sort((left, right) =>
  (left.title_id_padded ?? left.title_id).localeCompare(right.title_id_padded ?? right.title_id)
);

const formatDesignator = (value) => {
  if (!value) return value;
  const match = value.match(/^0*([0-9]+)([a-z]*)$/i);
  if (!match) return value.toUpperCase();
  const number = String(Number(match[1]));
  const suffix = match[2] ? match[2].toUpperCase() : "";
  return `${number}${suffix}`;
};

const normalizeSlug = (value) => value?.toLowerCase();
---

<Base title="Authority · Titles" description="Browse titles in the Connecticut General Statutes.">
  <header class="site-header">
    <div class="logo">Authority</div>
    <nav class="nav">
      <a href="/">Home</a>
      <a href="/titles/">Titles</a>
    </nav>
  </header>

  <main class="title-page">
    <section class="section-heading">
      <p class="eyebrow">Connecticut General Statutes</p>
      <h1>Titles</h1>
      <p class="lead">Browse by title, then drill into chapters and sections.</p>
    </section>

    <section class="section-block">
      <div class="section-title">
        <h2>All titles</h2>
      </div>
      <div class="section-list">
        {titles.map((title) => (
          <a class="section-row" href={`/titles/${normalizeSlug(title.title_id_display ?? title.title_id)}/`}>
            <span class="section-number">Title {title.title_id_display ?? formatDesignator(title.title_id)}</span>
            <span class="section-title-text">
              {title.title_name ? `${title.title_name} · ` : ""}
              {title.chapter_count} chapters · {title.section_count} sections
            </span>
          </a>
        ))}
      </div>
    </section>
  </main>
</Base>
