name = "fastlaw-ingest"
compatibility_date = "2026-01-20"
main = "src/worker.ts"
compatibility_flags = ["nodejs_compat"]

[limits]
cpu_ms = 300000

[[d1_databases]]
binding = "DB"
database_name = "fastlaw"
database_id = "dc9efc6c-abb6-4790-9546-c3565022c186"
migrations_dir = "../../db/migrations"

[[r2_buckets]]
binding = "STORAGE"
bucket_name = "fastlaw-content"

[[queues.producers]]
binding = "INGEST_SHARDS_QUEUE"
queue = "fastlaw-ingest-shards"

[[queues.consumers]]
queue = "fastlaw-ingest-shards"
max_batch_size = 1
max_retries = 3

[ai]
binding = "AI"

[[vectorize]]
binding = "VECTOR_SEARCH_INDEX"
index_name = "fastlaw-search"

[[workflows]]
name = "vector-ingest-workflow"
binding = "VECTOR_WORKFLOW"
class_name = "VectorIngestWorkflow"

[vars]
# Source URLs
CGA_BASE_URL = "https://www.cga.ct.gov"
CGA_START_PATH = "/current/pub/titles.htm"
MGL_BASE_URL = "https://malegislature.gov"
MGL_START_PATH = "/Laws/GeneralLaws"
USC_DOWNLOAD_BASE = "https://uscode.house.gov/download/releasepoints"

[observability]
enabled = true
head_sampling_rate = 1

[observability.logs]
enabled = true
head_sampling_rate = 1
persist = true
invocation_logs = true

[observability.traces]
enabled = true
head_sampling_rate = 1
