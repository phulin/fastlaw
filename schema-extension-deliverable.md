# Schema Extension Execution Deliverable

## What Changed
- Added `sources`, `levels`, and `documents` tables + indexes (migration already in `db/migrations/0001_sources_levels_documents.sql`).
- Extended the CT migration script to backfill these new tables and to emit R2 content under URL-aligned slugs.

## CT Backfill Strategy
- Source row: one `sources` entry for `cgs`.
- Each CT section becomes a `documents` row with:
  - `slug = statutes/cgs/section/{title}/{sec}`
  - R2 content stored at `data/r2/${slug}.json`
- Breadcrumbs in `levels`:
  - Level 0: titles (`lvl_cgs_title_{titleId}`)
  - Level 1: chapters (`lvl_cgs_chapter_{chapterId}`)
  - Level 2: sections (`lvl_cgs_section_{sectionNumber}`), linked to `documents`.

## How To Move Existing CGS Data
1. Re-run the migration script to regenerate D1 SQL and URL-aligned R2 content:
   - `yarn migrate`
   - Output:
     - `data/d1/import.sql` (now includes `sources`, `levels`, `documents` inserts)
     - `data/r2/statutes/cgs/section/.../*.json` (new URL-aligned path)
2. Apply schema + import (local example):
   - `yarn migrate:local`
   - `wrangler d1 execute fastlaw --local --file=data/d1/import.sql`
3. Upload R2 content:
   - `wrangler r2 object put fastlaw-content --local --recursive data/r2/`

## Notes
- Existing CT routes continue to use `sections.r2_key`; those now point at the URL-aligned slug paths generated by the migration.
